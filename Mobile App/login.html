<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Draxyl</title>
    <link rel="stylesheet" href="draxyl-website.css">
    <link rel="stylesheet" href="signup-form.css">
    <style>
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .login-box {
            background: #000000;
            border-radius: 20px;
            padding: 40px;
            max-width: 450px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .login-box h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #FFFFFF;
        }
        
        .login-box p {
            text-align: center;
            color: #FFFFFF;
            margin-bottom: 30px;
        }
        
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #FFFFFF;
            text-decoration: none;
            font-weight: 500;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <a href="draxyl-web.html" class="back-link">‚Üê Back to Home</a>
            <h1>Welcome Back!</h1>
            <p>Log in to your Draxyl account</p>
            <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 12px 16px; border-radius: 10px; margin-bottom: 20px; font-size: 0.85rem; line-height: 1.5;">
                <strong>üõ°Ô∏è Military-Grade Security:</strong> Your passwords are protected with bcrypt encryption. Even if hackers steal our database, your email, account, and passwords are <strong>HUMANLY IMPOSSIBLE</strong> to crack (~500 years with modern hardware).
            </div>
            
            <form id="loginForm" class="signup-form">
                <input type="email" id="loginEmail" placeholder="Email Address" required>
                <input type="password" id="loginPassword" placeholder="Password" required>
                <button type="submit">Log In</button>
                <div id="loginMessage" style="display:none;padding:10px;border-radius:8px;text-align:center;"></div>
            </form>
            
            <p style="margin-top:20px;font-size:0.95rem;">
                Don't have an account? <a href="draxyl-web.html#signup">Sign up</a>
            </p>
        </div>
    </div>
    
    <script src="security.js"></script>
    <script>
        const loginForm = document.getElementById('loginForm');
        const messageDiv = document.getElementById('loginMessage');
        
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = Security.sanitizeInput(document.getElementById('loginEmail').value);
            const password = document.getElementById('loginPassword').value; // Don't sanitize password
            
            // Validate email format
            if (!Security.validateEmail(email)) {
                messageDiv.style.display = 'block';
                messageDiv.style.background = '#f8d7da';
                messageDiv.style.color = '#721c24';
                messageDiv.textContent = 'Please enter a valid email address';
                return;
            }
            
            const submitBtn = loginForm.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Logging in...';
            submitBtn.disabled = true;
            
            try {
                const API_URL = window.location.origin;
                console.log('Attempting login to:', `${API_URL}/api/login`);

                const response = await fetch(`${API_URL}/api/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    mode: 'cors',
                    body: JSON.stringify({ email, password })
                });
                
                console.log('Response status:', response.status);
                
                const data = await response.json();
                console.log('Response data:', data);
                
                if (data.success) {
                    // Store JWT token and user data securely
                    if (data.token) {
                        Security.setToken(data.token);
                    }
                    Security.setSecureData('user', data.user);
                    
                    // Also store in localStorage for backward compatibility
                    localStorage.setItem('draxylUser', JSON.stringify(data.user));
                    
                    messageDiv.style.display = 'block';
                    messageDiv.style.background = '#d4edda';
                    messageDiv.style.color = '#155724';
                    messageDiv.textContent = '‚úÖ Login successful! Redirecting...';
                    
                    // Redirect to main page
                    setTimeout(() => {
                        window.location.href = 'draxyl-web.html';
                    }, 1500);
                } else {
                    messageDiv.style.display = 'block';
                    messageDiv.style.background = '#f8d7da';
                    messageDiv.style.color = '#721c24';
                    messageDiv.textContent = Security.escapeHTML(data.message);
                    
                    // Log security event for failed login
                    if (data.message.includes('locked') || data.message.includes('attempts')) {
                        Security.logSecurityEvent('FAILED_LOGIN_ATTEMPT', { email });
                    }
                }
            } catch (error) {
                console.error('Login error details:', error);
                messageDiv.style.display = 'block';
                messageDiv.style.background = '#f8d7da';
                messageDiv.style.color = '#721c24';
                messageDiv.innerHTML = `<strong>Connection Error</strong><br>
                    Cannot reach backend server.<br><br>
                    <strong>Possible issues:</strong><br>
                    ‚Ä¢ Backend not running (run: python app.py)<br>
                    ‚Ä¢ Dev tunnel URL expired or incorrect<br>
                    ‚Ä¢ CORS/Network issue<br><br>
                    Error: ${error.message}`;
                Security.logSecurityEvent('LOGIN_CONNECTION_ERROR', { error: error.message });
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>



